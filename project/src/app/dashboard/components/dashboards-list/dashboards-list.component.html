<div class="dashboards-container">
  <div class="dashboards-wrapper">
    <div class="dashboards-header">
      <div class="header-content">
        <div class="title-container">
          <h1>Dashboards</h1>
        </div>
        <button class="new-project-button" (click)="navigateToCreateWithJson()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          New Project
        </button>
      </div>
      <div class="header-description">
        Create and manage dashboards to visualize your secrets
      </div>
    </div>

    <div class="dashboards-content">
      <div class="search-and-filters">
        <div class="search-container">
          <div class="search-input-wrapper">
            <div class="search-input-prefix">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                aria-hidden="true"
                width="16"
                height="16"
                class="search-icon"
                fill="#ffffff"
              >
                <path
                  d="M21.71,20.29,18,16.61A9,9,0,1,0,16.61,18l3.68,3.68a1,1,0,0,0,1.42,0A1,1,0,0,0,21.71,20.29ZM11,18a7,7,0,1,1,7-7A7,7,0,0,1,11,18Z"
                ></path>
              </svg>
            </div>
            <input
              class="dashboards-search-input"
              type="text"
              placeholder="Search dashboards"
            />
          </div>
        </div>

        <div class="filters-container">
          <div class="filter-group">
            <div class="tag-filter-wrapper">
              <div class="tag-filter-container" (click)="toggleTagDropdown($event)" [class.dropdown-open]="showTagDropdown">
                <div class="tag-filter-prefix">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    width="16"
                    height="16"
                    class="filter-icon"
                  >
                    <path
                      d="M7.5,6A1.5,1.5,0,1,0,9,7.5,1.5,1.5,0,0,0,7.5,6Zm13.62,4.71L12.71,2.29A1,1,0,0,0,12,2H3A1,1,0,0,0,2,3v9a1,1,0,0,0,.29.71l8.42,8.41a3,3,0,0,0,4.24,0L21.12,15a3,3,0,0,0,0-4.24Zm-1.41,2.82h0l-6.18,6.17a1,1,0,0,1-1.41,0L4,11.59V4h7.59l8.12,8.12a1,1,0,0,1,.29.71A1,1,0,0,1,19.71,13.53Z"
                    ></path>
                  </svg>
                </div>
                <div class="tag-filter-value-container">
                  <div class="tag-filter-placeholder">{{ selectedTag ? selectedTag : 'Filter by tag' }}</div>
                </div>
                <div class="tag-filter-suffix">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    width="16"
                    height="16"
                    class="caret-down"
                  >
                    <path
                      d="M17,9.17a1,1,0,0,0-1.41,0L12,12.71,8.46,9.17a1,1,0,0,0-1.41,0,1,1,0,0,0,0,1.42l4.24,4.24a1,1,0,0,0,1.42,0L17,10.59A1,1,0,0,0,17,9.17Z"
                    ></path>
                  </svg>
                </div>
              </div>
              
              <!-- Tag dropdown menu -->
              <div class="tag-dropdown" *ngIf="showTagDropdown">
                <div class="tag-option" (click)="setSelectedTag(null); $event.stopPropagation()">
                  <span>All tags</span>
                </div>
                <div *ngFor="let tag of getAllTags()" class="tag-option" (click)="setSelectedTag(tag); $event.stopPropagation()">
                  <span>{{ tag }}</span>
                </div>
              </div>
            </div>

            <div class="starred-filter">
              <label class="checkbox-container">
                <div class="checkbox-wrapper">
                  <input type="checkbox" class="checkbox-input" (change)="toggleStarredFilter($event)" />
                  <span class="checkbox-checkmark"></span>
                </div>
                <span class="checkbox-label">Starred</span>
              </label>
            </div>
          </div>

          <div class="view-and-sort">
            <div class="view-options" role="radiogroup">
              <div class="view-option" data-testid="data-testid radio-button">
                <input
                  type="radio"
                  class="radio-input"
                  id="option-folders"
                  name="view-mode"
                  [checked]="viewMode === 'folders'"
                  (change)="setViewMode('folders')"
                />
                <label
                  class="radio-label"
                  for="option-folders"
                  title="View by folders"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    width="16"
                    height="16"
                    class="view-icon"
                  >
                    <path
                      d="M19,5.5H12.72l-.32-1a3,3,0,0,0-2.84-2H5a3,3,0,0,0-3,3v13a3,3,0,0,0,3,3H19a3,3,0,0,0,3-3V8.5A3,3,0,0,0,19,5.5Zm1,13a1,1,0,0,1-1,1H5a1,1,0,0,1-1-1V5.5a1,1,0,0,1,1-1H9.56a1,1,0,0,1,.95.68l.54,1.64A1,1,0,0,0,12,7.5h7a1,1,0,0,1,1,1Z"
                    ></path>
                  </svg>
                </label>
              </div>
              <div class="view-option" data-testid="data-testid radio-button">
                <input
                  type="radio"
                  class="radio-input"
                  id="option-list"
                  name="view-mode"
                  [checked]="viewMode === 'list'"
                  (change)="setViewMode('list')"
                />
                <label
                  class="radio-label"
                  for="option-list"
                  title="View as list"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    width="16"
                    height="16"
                    class="view-icon"
                  >
                    <path
                      d="M3.71,16.29a1,1,0,0,0-.33-.21,1,1,0,0,0-.76,0,1,1,0,0,0-.33.21,1,1,0,0,0-.21.33,1,1,0,0,0,.21,1.09,1.15,1.15,0,0,0,.33.21.94.94,0,0,0,.76,0,1.15,1.15,0,0,0,.33-.21,1,1,0,0,0,.21-1.09A1,1,0,0,0,3.71,16.29ZM7,8H21a1,1,0,0,0,0-2H7A1,1,0,0,0,7,8ZM3.71,11.29a1,1,0,0,0-1.09-.21,1.15,1.15,0,0,0-.33.21,1,1,0,0,0-.21.33.94.94,0,0,0,0,.76,1.15,1.15,0,0,0,.21.33,1.15,1.15,0,0,0,.33.21.94.94,0,0,0,.76,0,1.15,1.15,0,0,0,.33-.21,1.15,1.15,0,0,0,.21-.33.94.94,0,0,0,0-.76A1,1,0,0,0,3.71,11.29ZM21,11H7a1,1,0,0,0,0,2H21a1,1,0,0,0,0-2ZM3.71,6.29a1,1,0,0,0-.33-.21,1,1,0,0,0-1.09.21,1.15,1.15,0,0,0-.21.33.94.94,0,0,0,0,.76,1.15,1.15,0,0,0,.21.33,1.15,1.15,0,0,0,.33.21,1,1,0,0,0,1.09-.21,1.15,1.15,0,0,0,.21-.33.94.94,0,0,0,0-.76A1.15,1.15,0,0,0,3.71,6.29ZM21,16H7a1,1,0,0,0,0,2H21a1,1,0,0,0,0-2Z"
                    ></path>
                  </svg>
                </label>
              </div>
            </div>

            <div class="sort-wrapper">
              <div class="sort-container" (click)="toggleSortDropdown($event)" [class.dropdown-open]="showSortDropdown">
                <div class="sort-prefix">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    data-name="Layer 1"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    width="16"
                    height="16"
                    class="filter-icon"
                  >
                    <path
                      d="M5.71,6.29a1,1,0,0,0-.33-.21,1,1,0,0,0-.76,0,1,1,0,0,0-.33.21l-2,2A1,1,0,0,0,3.71,9.71L4,9.41V17a1,1,0,0,0,2,0V9.41l.29.3a1,1,0,0,0,1.42,0,1,1,0,0,0,0-1.42ZM11,8H21a1,1,0,0,0,0-2H11a1,1,0,0,0,0,2Zm10,8H11a1,1,0,0,0,0,2H21a1,1,0,0,0,0-2Zm0-5H11a1,1,0,0,0,0,2H21a1,1,0,0,0,0-2Z"
                    ></path>
                  </svg>
                </div>
                <div class="sort-value-container">
                  <div class="sort-placeholder">
                    <span *ngIf="sortOrder === 'none'">Sort</span>
                    <span *ngIf="sortOrder === 'asc'">Alphabetically (A–Z)</span>
                    <span *ngIf="sortOrder === 'desc'">Alphabetically (Z–A)</span>
                  </div>
                </div>
                <div class="sort-suffix">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    width="16"
                    height="16"
                    class="caret-down"
                  >
                    <path
                      d="M17,9.17a1,1,0,0,0-1.41,0L12,12.71,8.46,9.17a1,1,0,0,0-1.41,0,1,1,0,0,0,0,1.42l4.24,4.24a1,1,0,0,0,1.42,0L17,10.59A1,1,0,0,0,17,9.17Z"
                    ></path>
                  </svg>
                </div>
              </div>
              
              <!-- Sort dropdown menu -->
              <div class="sort-dropdown" *ngIf="showSortDropdown">
                <div class="sort-option" (click)="setSortOrder('none'); showSortDropdown = false; $event.stopPropagation()">
                  <span>None</span>
                </div>
                <div class="sort-option" (click)="setSortOrder('asc'); showSortDropdown = false; $event.stopPropagation()">
                  <span>Alphabetically (A–Z)</span>
                </div>
                <div class="sort-option" (click)="setSortOrder('desc'); showSortDropdown = false; $event.stopPropagation()">
                  <span>Alphabetically (Z–A)</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="dashboards-table-container" *ngIf="!starredFilterActive">
        <div class="dashboards-table">
          <!-- Folders view -->
          <div *ngIf="viewMode === 'folders'" class="table-header" role="row">
            <div class="table-header-cell name-column">Name</div>
            <div class="table-header-cell tags-column">Tags</div>
          </div>

          <!-- List view -->
          <div *ngIf="viewMode === 'list'" class="table-header" role="row">
            <div class="table-header-cell name-column">Name</div>
            <div class="table-header-cell">Type</div>
            <div class="table-header-cell">Location</div>
            <div class="table-header-cell tags-column">Tags</div>
          </div>

          <div class="table-body" role="rowgroup">
            <!-- Folders view content -->
            <div *ngIf="viewMode === 'folders'">
              <div *ngIf="folders.length === 0" class="empty-state">
                <p>
                  No dashboards found. Create your first dashboard to get
                  started.
                </p>
              </div>
              <div *ngFor="let folder of folders" class="folder-container">
                <div class="folder-header" (click)="toggleFolder(folder.name)" *ngIf="editingFolder !== folder.name && deletingFolder !== folder.name">
                  <div class="folder-icon">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                      width="24"
                      height="24"
                      fill="currentColor"
                    >
                      <path
                        d="M19,5.5H12.72l-.32-1a3,3,0,0,0-2.84-2H5a3,3,0,0,0-3,3v13a3,3,0,0,0,3,3H19a3,3,0,0,0,3-3V8.5A3,3,0,0,0,19,5.5Zm1,13a1,1,0,0,1-1,1H5a1,1,0,0,1-1-1V5.5a1,1,0,0,1,1-1H9.56a1,1,0,0,1,.95.68l.54,1.64A1,1,0,0,0,12,7.5h7a1,1,0,0,1,1,1Z"
                      ></path>
                    </svg>
                  </div>
                  <div class="folder-name">{{ folder.name }}</div>
                  <div class="folder-actions">
                    <button class="folder-action-btn" (click)="startEditingFolder(folder.name); $event.stopPropagation();" title="Edit folder name">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 20h9"></path>
                        <path d="M16.5 3.5a2.121 2.121 0,0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                      </svg>
                    </button>
                    <button class="folder-action-btn" (click)="startDeletingFolder(folder.name); $event.stopPropagation();" title="Delete folder">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                      </svg>
                    </button>
                  </div>
                  <div class="folder-chevron" [class.rotated]="isFolderExpanded(folder.name)">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                      width="16"
                      height="16"
                      fill="currentColor"
                    >
                      <path
                        d="M9 18l6-6-6-6"
                      ></path>
                    </svg>
                  </div>
                </div>
                
                <!-- Folder tags section -->
                <div class="folder-tags-section" *ngIf="isFolderExpanded(folder.name) && editingFolder !== folder.name && deletingFolder !== folder.name">
                  <div class="folder-tags-header">
                    <span class="tags-label">Tags:</span>
                    <button class="add-tag-btn" (click)="addFolderTag(folder.name); $event.stopPropagation();" title="Add tag to folder">
                      +
                    </button>
                  </div>
                  <div class="folder-tags-container">
                    <span *ngFor="let tag of getFolderTags(folder)" class="tag">
                      {{ tag }}
                    </span>
                    <span *ngIf="getFolderTags(folder).length === 0" class="no-tags">No tags</span>
                  </div>
                </div>
                
                <!-- Edit folder UI -->
                <div class="folder-header edit-folder-header" *ngIf="editingFolder === folder.name">
                  <div class="folder-icon">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                      width="24"
                      height="24"
                      fill="currentColor"
                    >
                      <path
                        d="M19,5.5H12.72l-.32-1a3,3,0,0,0-2.84-2H5a3,3,0,0,0-3,3v13a3,3,0,0,0,3,3H19a3,3,0,0,0,3-3V8.5A3,3,0,0,0,19,5.5Zm1,13a1,1,0,0,1-1,1H5a1,1,0,0,1-1-1V5.5a1,1,0,0,1,1-1H9.56a1,1,0,0,1,.95.68l.54,1.64A1,1,0,0,0,12,7.5h7a1,1,0,0,1,1,1Z"
                      ></path>
                    </svg>
                  </div>
                  <input 
                    class="folder-name-input" 
                    [(ngModel)]="newFolderName" 
                    (keyup.enter)="confirmEditingFolder()" 
                    (keyup.escape)="cancelEditingFolder()"
                    placeholder="Enter folder name"
                    autofocus
                  />
                  <div class="folder-actions">
                    <button class="folder-action-btn confirm-btn" (click)="confirmEditingFolder(); $event.stopPropagation();" title="Confirm">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="20 6 9 17 4 12"></polyline>
                      </svg>
                    </button>
                    <button class="folder-action-btn cancel-btn" (click)="cancelEditingFolder(); $event.stopPropagation();" title="Cancel">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                      </svg>
                    </button>
                  </div>
                </div>
                
                <!-- Delete folder confirmation UI -->
                <div class="folder-header delete-folder-header" *ngIf="deletingFolder === folder.name">
                  <div class="folder-icon">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                      width="24"
                      height="24"
                      fill="currentColor"
                    >
                      <path
                        d="M19,5.5H12.72l-.32-1a3,3,0,0,0-2.84-2H5a3,3,0,0,0-3,3v13a3,3,0,0,0,3,3H19a3,3,0,0,0,3-3V8.5A3,3,0,0,0,19,5.5Zm1,13a1,1,0,0,1-1,1H5a1,1,0,0,1-1-1V5.5a1,1,0,0,1,1-1H9.56a1,1,0,0,1,.95.68l.54,1.64A1,1,0,0,0,12,7.5h7a1,1,0,0,1,1,1Z"
                      ></path>
                    </svg>
                  </div>
                  <div class="folder-name delete-confirm-text">Delete folder "{{ folder.name }}" and all its projects?</div>
                  <div class="folder-actions">
                    <button class="folder-action-btn confirm-btn" (click)="confirmDeletingFolder(); $event.stopPropagation();" title="Confirm">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="20 6 9 17 4 12"></polyline>
                      </svg>
                    </button>
                    <button class="folder-action-btn cancel-btn" (click)="cancelDeletingFolder(); $event.stopPropagation();" title="Cancel">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="folder-projects" *ngIf="isFolderExpanded(folder.name)">
                  <div *ngFor="let project of folder.projects" class="project-item" (click)="navigateToProject(project.id)">
                  <div class="project-content">
                    <div class="project-name">{{ project.name }}</div>
                    <div class="project-meta">
                    </div>
                  </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- List view content -->
            <div *ngIf="viewMode === 'list'">
              <div *ngIf="dashboards.length === 0" class="empty-state">
                <p>
                  No dashboards found. Create your first dashboard to get
                  started.
                </p>
              </div>
              <div *ngFor="let dashboard of dashboards" class="list-row" role="row" (click)="navigateToProject(dashboard.id)">
                <div class="list-cell name-column" role="gridcell">
                  <div class="name-cell-content">
                    <div class="name-icon">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        aria-hidden="true"
                        width="16"
                        height="16"
                        fill="currentColor"
                      >
                        <path
                          d="M19,5.5H12.72l-.32-1a3,3,0,0,0-2.84-2H5a3,3,0,0,0-3,3v13a3,3,0,0,0,3,3H19a3,3,0,0,0,3-3V8.5A3,3,0,0,0,19,5.5Zm1,13a1,1,0,0,1-1,1H5a1,1,0,0,1-1-1V5.5a1,1,0,0,1,1-1H9.56a1,1,0,0,1,.95.68l.54,1.64A1,1,0,0,0,12,7.5h7a1,1,0,0,1,1,1Z"
                        ></path>
                      </svg>
                    </div>
                    <span class="dashboard-name">{{ dashboard.name }}</span>
                  </div>
                </div>
                <div class="list-cell" role="gridcell">{{ dashboard.type }}</div>
                <div class="list-cell" role="gridcell">{{ dashboard.folder || 'No folder' }}</div>
                <div class="list-cell tags-column" role="gridcell">
                  <div class="tags-container">
                    <span
                      *ngFor="let tag of dashboard.tags"
                      class="tag"
                    >
                      {{ tag }}
                    </span>
                    <span *ngIf="dashboard.tags.length === 0" class="no-tags">No tags</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
